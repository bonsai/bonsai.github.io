<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¶ã©ã†ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ </title>
    <style>
        /* CSSã¯å¤‰æ›´ãªã— */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #girlCanvas { /* #girl ã‹ã‚‰ #girlCanvas ã«å¤‰æ›´ */
            position: absolute;
            bottom: 50px;
            /* leftã¨transformã¯JSã§åˆ¶å¾¡ã™ã‚‹ãŸã‚ã€åˆæœŸå€¤ã¨ã—ã¦æ®‹ã—ã¤ã¤ã€JSã§ä¸Šæ›¸ãã•ã‚Œã‚‹ã“ã¨ã‚’æƒ³å®š */
            left: 50%; 
            transform: translateX(-50%);
            width: 120px;
            height: 160px;
            z-index: 10;
            transition: none; /* leftã‚’ç›´æ¥æ“ä½œã™ã‚‹ãŸã‚ã€transitionã¯ç„¡åŠ¹åŒ– */
        }

        .jumping {
            bottom: 150px !important;
        }

        .grape {
            position: absolute;
            width: 80px;
            height: 80px;
            z-index: 5;
            animation: fall linear;
        }

        .juice-drop {
            position: absolute;
            width: 60px;
            height: 80px;
            z-index: 5;
            animation: fall linear;
        }

        @keyframes fall {
            from {
                top: -80px;
            }
            to {
                top: 100vh;
            }
        }

        #ui {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: 24px;
            font-weight: bold;
            z-index: 20;
        }

        #healthBar {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 30px;
            background: rgba(255,255,255,0.3);
            border: 3px solid white;
            border-radius: 15px;
            overflow: hidden;
            z-index: 20;
        }

        #healthFill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffa500, #32cd32);
            border-radius: 12px;
            transition: width 0.3s ease;
            width: 100%;
        }

        #grapeCounter {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 20;
        }

        .floating-text {
            position: absolute;
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            z-index: 25;
            animation: floatUp 1s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }

        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #startScreen h1 {
            color: white;
            font-size: 48px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 30px;
        }

        #startButton {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        #startButton:hover {
            transform: scale(1.1);
        }

        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            opacity: 0.8;
            animation: drift 20s linear infinite;
        }

        .cloud:before {
            content: '';
            position: absolute;
            background: white;
            border-radius: 50px;
        }

        .cloud1 {
            width: 100px;
            height: 40px;
            top: 20%;
            animation-duration: 25s;
        }

        .cloud1:before {
            width: 50px;
            height: 40px;
            top: -20px;
            left: 10px;
        }

        .cloud2 {
            width: 80px;
            height: 30px;
            top: 40%;
            animation-duration: 30s;
            animation-delay: -10s;
        }

        .cloud2:before {
            width: 40px;
            height: 30px;
            top: -15px;
            left: 15px;
        }

        @keyframes drift {
            from {
                left: -120px;
            }
            to {
                left: 100vw;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>

        <div id="startScreen">
            <h1>ğŸ‡ ã¶ã©ã†ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ  ğŸ‡</h1>
            <p style="color: white; font-size: 20px; margin-bottom: 30px; text-align: center; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
                ã¶ã©ã†ã‚’11å€‹ã‚ã¤ã‚ã¦<br>ã‚¸ãƒ¥ãƒ¼ã‚¹ã‚’é£²ã‚‚ã†ï¼
            </p>
            <button id="startButton" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
        </div>

        <canvas id="juiceCanvas" width="100" height="120" style="position: absolute; top: 20px; left: 20px; z-index: 15;"></canvas>
        
        <div id="ui">
            <div>ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
        </div>

        <div id="healthBar">
            <div id="healthFill"></div>
        </div>

        <div id="grapeCounter">
            ã¶ã©ã†: <span id="grapeCount">0</span> / 11
        </div>

        <canvas id="girlCanvas" width="120" height="160"></canvas>
    </div>
<script>
    let gameState = {
        isPlaying: false,
        score: 0,
        health: 100,
        grapeCount: 0,
        girlX: window.innerWidth / 2, // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸­å¤®ä½ç½®
        grapes: [],
        grapeSpeed: 2,
        spawnRate: 0.02
    };

    // ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®š
    const girlCanvas = document.getElementById('girlCanvas');
    const girlCtx = girlCanvas.getContext('2d');
    const juiceCanvas = document.getElementById('juiceCanvas');
    const juiceCtx = juiceCanvas.getContext('2d');

    const girlImage = new Image();
    // ã“ã“ã‚’PNGãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒ‘ã‚¹ã«å¤‰æ›´ã—ã¾ã™
    // ä¾‹: girl.pngã¨ã„ã†åå‰ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãŒHTMLãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹å ´åˆ
    girlImage.src = "./girl.png"; 
    
    let isGirlImageLoaded = false;
    girlImage.onload = () => {
        isGirlImageLoaded = true;
        drawGirl(); // ç”»åƒèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«åˆå›æç”»
        // ç”»åƒãŒãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‰girlCanvasã®åˆæœŸä½ç½®ã‚’æ›´æ–°
        girlCanvas.style.left = (gameState.girlX - girlCanvas.width / 2) + 'px';
    };
    girlImage.onerror = () => {
        console.error("å¥³ã®å­ã®ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„: " + girlImage.src);
        alert("å¥³ã®å­ã®ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã€‚");
    };

    // å¥³ã®å­ã‚’æç”»ã™ã‚‹é–¢æ•°
    function drawGirl() {
        girlCtx.clearRect(0, 0, girlCanvas.width, girlCanvas.height);
        if (isGirlImageLoaded) {
            // ç”»åƒã‚’canvasã«æç”»ã—ã¾ã™
            girlCtx.drawImage(girlImage, 0, 0, girlCanvas.width, girlCanvas.height);
        }
    }
    
    function drawJuice() {
        juiceCtx.clearRect(0, 0, 100, 120);
        
        // ã‚°ãƒ©ã‚¹
        juiceCtx.strokeStyle = 'black';
        juiceCtx.lineWidth = 3;
        juiceCtx.beginPath();
        juiceCtx.roundRect(20, 20, 60, 80, 5);
        juiceCtx.stroke();
        
        // ã‚¸ãƒ¥ãƒ¼ã‚¹
        const fillHeight = Math.min(70, (gameState.grapeCount / 11) * 70);
        if (fillHeight > 0) {
            juiceCtx.fillStyle = '#8A2BE2';
            juiceCtx.beginPath();
            juiceCtx.roundRect(23, 97 - fillHeight, 54, fillHeight, 3);
            juiceCtx.fill();
            
            // æ³¡
            if (fillHeight > 10) {
                juiceCtx.fillStyle = 'rgba(255,255,255,0.7)';
                for (let i = 0; i < 5; i++) {
                    const x = 30 + Math.random() * 40;
                    const y = 90 - fillHeight + Math.random() * (fillHeight - 10);
                    juiceCtx.beginPath();
                    juiceCtx.arc(x, y, 2, 0, Math.PI * 2);
                    juiceCtx.fill();
                }
            }
        }
    }

    function createGrape() {
        const grape = document.createElement('div');
        grape.className = 'grape';
        grape.style.left = Math.random() * (window.innerWidth - 80) + 'px';
        grape.style.animationDuration = (3 + Math.random() * 2) + 's';
        
        // ã¶ã©ã†ã‚’æç”»
        const canvas = document.createElement('canvas');
        canvas.width = 80;
        canvas.height = 80;
        const ctx = canvas.getContext('2d');
        
        // ã¶ã©ã†ã®æˆ¿
        ctx.fillStyle = '#8A2BE2';
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 4 - i; j++) {
                ctx.beginPath();
                ctx.arc(20 + j * 15 + i * 7, 25 + i * 12, 8, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // èŒ
        ctx.strokeStyle = '#228B22';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(40, 10);
        ctx.lineTo(40, 25);
        ctx.stroke();
        
        grape.appendChild(canvas);
        document.getElementById('gameContainer').appendChild(grape);
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®å‡¦ç†
        grape.addEventListener('animationend', () => {
            if (grape.parentNode) { // æ—¢ã«ã‚­ãƒ£ãƒƒãƒã•ã‚Œã¦ã„ãªã‘ã‚Œã°
                grape.remove();
                gameState.health -= 5;
                updateHealth();
            }
        });
        
        return grape;
    }

    function checkCollision(grape) {
        const grapeRect = grape.getBoundingClientRect();
        const girlRect = girlCanvas.getBoundingClientRect();
        
        return (grapeRect.left < girlRect.right &&
                grapeRect.right > girlRect.left &&
                grapeRect.top < girlRect.bottom &&
                grapeRect.bottom > girlRect.top);
    }

    function catchGrape(grape) {
        grape.remove();
        gameState.grapeCount++;
        gameState.score += 10;
        
        // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆ
        // girlXã¯ä¸­å¤®åº§æ¨™ãªã®ã§ã€ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºä½ç½®ã‚‚èª¿æ•´
        showFloatingText('+10', gameState.girlX - 20, window.innerHeight - 100);
        
        updateUI();
        
        if (gameState.grapeCount >= 11) {
            drinkJuice();
        }
    }

    function drinkJuice() {
        gameState.health = Math.min(100, gameState.health + 30);
        gameState.grapeCount = 0;
        gameState.score += 50;
        
        showFloatingText('ã‚¸ãƒ¥ãƒ¼ã‚¹å®Œæˆï¼ +50', gameState.girlX - 50, window.innerHeight - 150);
        updateUI();
        updateHealth();
    }

    function showFloatingText(text, x, y) {
        const element = document.createElement('div');
        element.className = 'floating-text';
        element.textContent = text;
        element.style.left = x + 'px';
        element.style.top = y + 'px';
        document.getElementById('gameContainer').appendChild(element);
        
        setTimeout(() => element.remove(), 1000);
    }

    function updateUI() {
        document.getElementById('score').textContent = gameState.score;
        document.getElementById('grapeCount').textContent = gameState.grapeCount;
        drawJuice();
    }

    function updateHealth() {
        const healthPercent = Math.max(0, gameState.health / 100 * 100);
        document.getElementById('healthFill').style.width = healthPercent + '%';
        
        if (gameState.health <= 0) {
            gameOver();
        }
    }

    function gameOver() {
        gameState.isPlaying = false;
        alert(`ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼\nã‚¹ã‚³ã‚¢: ${gameState.score}`);
        location.reload();
    }

    function startGame() {
        if (!isGirlImageLoaded) {
            alert("ç”»åƒã®èª­ã¿è¾¼ã¿ä¸­ã§ã™ã€‚ã‚‚ã†ä¸€åº¦ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");
            return;
        }
        document.getElementById('startScreen').style.display = 'none';
        gameState.isPlaying = true;
        drawJuice();
        gameLoop();
    }

    function gameLoop() {
        if (!gameState.isPlaying) return;
        
        // ã¶ã©ã†ã‚’ç”Ÿæˆ
        if (Math.random() < gameState.spawnRate) {
            createGrape();
        }
        
        // è¡çªåˆ¤å®š
        const grapes = document.querySelectorAll('.grape');
        grapes.forEach(grape => {
            if (checkCollision(grape)) {
                catchGrape(grape);
            }
        });
        
        // æ™‚é–“çµŒéã§ãƒ˜ãƒ«ã‚¹ãŒæ¸›å°‘
        if (Math.random() < 0.005) { // æ¸›å°‘é »åº¦ã‚’å°‘ã—ä¸‹ã’ã¾ã—ãŸ
            gameState.health -= 1;
            updateHealth();
        }
        
        requestAnimationFrame(gameLoop);
    }

    // ã‚¿ãƒƒãƒãƒ»ãƒã‚¦ã‚¹æ“ä½œ
    function handleMove(clientX) {
        if (!gameState.isPlaying) return;
        
        const girlWidth = girlCanvas.width;
        // ç”»é¢ã®ç«¯ã«è¡Œãéããªã„ã‚ˆã†ã«åˆ¶å¾¡ã—ã€ã‹ã¤ä¸­å¤®æƒãˆã‚’ç¶­æŒ
        gameState.girlX = Math.max(girlWidth / 2, Math.min(window.innerWidth - (girlWidth / 2), clientX));
        // girlCanvasã®å·¦ç«¯ã‚’è¨ˆç®—ã—ã¦è¨­å®š
        girlCanvas.style.left = (gameState.girlX - girlWidth / 2) + 'px';
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.addEventListener('mousemove', (e) => handleMove(e.clientX));
    document.addEventListener('touchmove', (e) => {
        e.preventDefault();
        handleMove(e.touches[0].clientX);
    }, { passive: false });

    // åˆæœŸåŒ–
    updateUI();
    updateHealth();
    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ç”»åƒã®èª­ã¿è¾¼ã¿ãŒã¾ã ã§ã‚ã‚Œã°ã€girlCanvasã¯ä¸­å¤®ã«è¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€ã“ã“ã§å†è¨­å®š
    // onloadã‚¤ãƒ™ãƒ³ãƒˆã§è¨­å®šã•ã‚Œã‚‹ã®ã§ã€ä¸è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒå¿µã®ãŸã‚
    girlCanvas.style.left = (gameState.girlX - girlCanvas.width / 2) + 'px';
</script>
</body>
</html>
