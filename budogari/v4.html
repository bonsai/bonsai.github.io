<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¶ã©ã†ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ </title>
    <style>
        /* å…¨ä½“ã®ãƒªã‚»ãƒƒãƒˆã¨åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤º */
            touch-action: none; /* ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ï¼‰ã‚’æŠ‘åˆ¶ */
            user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚’æŠ‘åˆ¶ */
        }

        /* ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* å¥³ã®å­ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #girlCanvas {
            position: absolute;
            bottom: 50px; /* åœ°é¢ã‹ã‚‰ã®åˆæœŸä½ç½® */
            left: 50%;
            transform: translateX(-50%); /* ä¸­å¤®æƒãˆ */
            width: 120px;
            height: 160px;
            z-index: 10;
            /* ã‚¸ãƒ£ãƒ³ãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
            transition: bottom 0.2s ease-out; 
        }

        /* ã‚¸ãƒ£ãƒ³ãƒ—æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #girlCanvas.jumping {
            bottom: 150px; /* ã‚¸ãƒ£ãƒ³ãƒ—æ™‚ã®é«˜ã• */
        }

        /* ã¶ã©ã†ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .grape {
            position: absolute;
            width: 80px;
            height: 80px;
            z-index: 5;
            animation: fall linear; /* è½ä¸‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }

        /* ã‚¸ãƒ¥ãƒ¼ã‚¹ã®ã—ãšãã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆç¾åœ¨ã®ã‚²ãƒ¼ãƒ ã§ã¯æœªä½¿ç”¨ï¼‰ */
        .juice-drop {
            position: absolute;
            width: 60px;
            height: 80px;
            z-index: 5;
            animation: fall linear;
        }

        /* è½ä¸‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ  */
        @keyframes fall {
            from {
                top: -80px; /* ç”»é¢å¤–ä¸Šéƒ¨ã‹ã‚‰é–‹å§‹ */
            }
            to {
                top: 100vh; /* ç”»é¢å¤–ä¸‹éƒ¨ã¾ã§è½ä¸‹ */
            }
        }

        /* UIè¦ç´ ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        #ui {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: 24px;
            font-weight: bold;
            z-index: 20;
        }

        /* ãƒ˜ãƒ«ã‚¹ãƒãƒ¼ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        #healthBar {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 30px;
            background: rgba(255,255,255,0.3);
            border: 3px solid white;
            border-radius: 15px;
            overflow: hidden;
            z-index: 20;
        }

        /* ãƒ˜ãƒ«ã‚¹ãƒãƒ¼ã®å®Ÿéš›ã®è¡¨ç¤ºéƒ¨åˆ† */
        #healthFill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffa500, #32cd32); /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
            border-radius: 12px;
            transition: width 0.3s ease; /* å¹…ã®å¤‰åŒ–ã‚’æ»‘ã‚‰ã‹ã« */
            width: 100%; /* åˆæœŸå€¤ */
        }

        /* ã¶ã©ã†ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #grapeCounter {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 20;
        }

        /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚¹ã‚³ã‚¢å¢—åŠ ãªã©ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .floating-text {
            position: absolute;
            color: #FFD700; /* é‡‘è‰² */
            font-size: 24px; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚µã‚¤ã‚º */
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€é */
            z-index: 25;
            animation: floatUp 1s ease-out forwards; /* æµ®ãä¸ŠãŒã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
            text-align: center; /* ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®æƒãˆ */
            white-space: nowrap; /* ãƒ†ã‚­ã‚¹ãƒˆã®æŠ˜ã‚Šè¿”ã—ã‚’é˜²ã */
        }

        /* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ  */
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #startScreen h1 {
            color: white;
            font-size: 48px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 30px;
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #startButton {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: transform 0.2s; /* ãƒ›ãƒãƒ¼æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }

        #startButton:hover {
            transform: scale(1.1);
        }

        /* é›²ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            opacity: 0.8;
            animation: drift 20s linear infinite; /* é›²ã®ç§»å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }

        .cloud:before {
            content: '';
            position: absolute;
            background: white;
            border-radius: 50px;
        }

        .cloud1 {
            width: 100px;
            height: 40px;
            top: 20%;
            animation-duration: 25s;
        }

        .cloud1:before {
            width: 50px;
            height: 40px;
            top: -20px;
            left: 10px;
        }

        .cloud2 {
            width: 80px;
            height: 30px;
            top: 40%;
            animation-duration: 30s;
            animation-delay: -10s; /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ã®é…å»¶ */
        }

        .cloud2:before {
            width: 40px;
            height: 30px;
            top: -15px;
            left: 15px;
        }

        /* é›²ã®ç§»å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ  */
        @keyframes drift {
            from {
                left: -120px; /* ç”»é¢å¤–å·¦ã‹ã‚‰é–‹å§‹ */
            }
            to {
                left: 100vw; /* ç”»é¢å¤–å³ã¾ã§ç§»å‹• */
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>

        <div id="startScreen">
            <h1>ğŸ‡ ã¶ã©ã†ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ  ğŸ‡</h1>
            <p style="color: white; font-size: 20px; margin-bottom: 30px; text-align: center; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
                ã¶ã©ã†ã‚’11å€‹ã‚ã¤ã‚ã¦<br>ã‚¸ãƒ¥ãƒ¼ã‚¹ã‚’é£²ã‚‚ã†ï¼
            </p>
            <button id="startButton" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
        </div>

        <canvas id="juiceCanvas" width="100" height="120" style="position: absolute; top: 20px; left: 20px; z-index: 15;"></canvas>
        
        <div id="ui">
            <div>ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
        </div>

        <div id="healthBar">
            <div id="healthFill"></div>
        </div>

        <div id="grapeCounter">
            ã¶ã©ã†: <span id="grapeCount">0</span> / 11
        </div>

        <canvas id="girlCanvas" width="120" height="160"></canvas>
    </div>
<script>
    // Web Audio APIã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    let gameState = {
        isPlaying: false,
        score: 0,
        health: 100,
        grapeCount: 0,
        girlX: window.innerWidth / 2, // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸­å¤®ä½ç½®
        grapes: [],
        grapeSpeed: 2,
        spawnRate: 0.02,
        isJumping: false, // ã‚¸ãƒ£ãƒ³ãƒ—çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ãƒ•ãƒ©ã‚°
        lastTapTime: 0, // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒæ¤œå‡ºç”¨
        moveDirection: 0, // -1: å·¦, 0: åœæ­¢, 1: å³
        playerSpeed: 8 // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç§»å‹•é€Ÿåº¦
    };

    // ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®š
    const girlCanvas = document.getElementById('girlCanvas');
    const girlCtx = girlCanvas.getContext('2d');
    const juiceCanvas = document.getElementById('juiceCanvas');
    const juiceCtx = juiceCanvas.getContext('2d');

    const girlImage = new Image();
    girlImage.src = "./girl.png"; 

    let isGirlImageLoaded = false;
    girlImage.onload = () => {
        isGirlImageLoaded = true;
        drawGirl(); // ç”»åƒèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«åˆå›æç”»
        // ç”»åƒãŒãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‰girlCanvasã®åˆæœŸä½ç½®ã‚’æ›´æ–°
        girlCanvas.style.left = (gameState.girlX - girlCanvas.width / 2) + 'px';
    };
    girlImage.onerror = () => {
        console.error("å¥³ã®å­ã®ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„: " + girlImage.src);
        alert("å¥³ã®å­ã®ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã€‚");
    };

    // ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ã®å‘¨æ³¢æ•°ï¼ˆä¸­å¤®Cã‚’åŸºæº–ã«ã—ãŸA4=440Hzã®éŸ³éšï¼‰
    const frequencies = {
        'do': 261.63, // C4
        're': 293.66, // D4
        'mi': 329.63, // E4
        'fa': 349.23, // F4
        'so': 392.00, // G4
        'la': 440.00, // A4
        'si': 493.88  // B4
    };
    const notes = ['do', 're', 'mi', 'fa', 'so', 'la', 'si'];

    // éŸ³ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
    function playNote(frequency, duration = 0.1, volume = 0.3) {
        if (!audioContext) return; 

        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.type = 'sine'; // 'sine', 'square', 'sawtooth', 'triangle' ãªã©
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);

        gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration); // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
    }

    // å¥³ã®å­ã‚’æç”»ã™ã‚‹é–¢æ•°
    function drawGirl() {
        girlCtx.clearRect(0, 0, girlCanvas.width, girlCanvas.height);
        if (isGirlImageLoaded) {
            girlCtx.drawImage(girlImage, 0, 0, girlCanvas.width, girlCanvas.height);
        }
    }

    function drawJuice() {
        juiceCtx.clearRect(0, 0, 100, 120);
        
        // ã‚°ãƒ©ã‚¹
        juiceCtx.strokeStyle = 'black';
        juiceCtx.lineWidth = 3;
        juiceCtx.beginPath();
        juiceCtx.roundRect(20, 20, 60, 80, 5);
        juiceCtx.stroke();
        
        // ã‚¸ãƒ¥ãƒ¼ã‚¹
        const fillHeight = Math.min(70, (gameState.grapeCount / 11) * 70);
        if (fillHeight > 0) {
            juiceCtx.fillStyle = '#8A2BE2';
            juiceCtx.beginPath();
            juiceCtx.roundRect(23, 97 - fillHeight, 54, fillHeight, 3);
            juiceCtx.fill();
            
            // æ³¡
            if (fillHeight > 10) {
                juiceCtx.fillStyle = 'rgba(255,255,255,0.7)';
                for (let i = 0; i < 5; i++) {
                    const x = 30 + Math.random() * 40;
                    const y = 90 - fillHeight + Math.random() * (fillHeight - 10);
                    juiceCtx.beginPath();
                    juiceCtx.arc(x, y, 2, 0, Math.PI * 2);
                    juiceCtx.fill();
                }
            }
        }
    }

    function createGrape() {
        const grape = document.createElement('div');
        grape.className = 'grape';
        grape.style.left = Math.random() * (window.innerWidth - 80) + 'px';
        grape.style.animationDuration = (3 + Math.random() * 2) + 's';
        
        // ã¶ã©ã†ã‚’æç”»
        const canvas = document.createElement('canvas');
        canvas.width = 80;
        canvas.height = 80;
        const ctx = canvas.getContext('2d');
        
        // ã¶ã©ã†ã®æˆ¿
        ctx.fillStyle = '#8A2BE2';
        for (let i = 0; i < 3; i++) {
            for (let j = 0; j < 4 - i; j++) {
                ctx.beginPath();
                ctx.arc(20 + j * 15 + i * 7, 25 + i * 12, 8, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // èŒ
        ctx.strokeStyle = '#228B22';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(40, 10);
        ctx.lineTo(40, 25);
        ctx.stroke();
        
        grape.appendChild(canvas);
        document.getElementById('gameContainer').appendChild(grape);
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®å‡¦ç†
        grape.addEventListener('animationend', () => {
            if (grape.parentNode) { // æ—¢ã«ã‚­ãƒ£ãƒƒãƒã•ã‚Œã¦ã„ãªã‘ã‚Œã°
                grape.remove();
                gameState.health -= 5;
                updateHealth();
            }
        });
        
        return grape;
    }

    function checkCollision(grape) {
        const grapeRect = grape.getBoundingClientRect();
        const girlRect = girlCanvas.getBoundingClientRect();
        
        // ã¶ã©ã†ã®åº•éƒ¨ãŒå¥³ã®å­ã®é ­ä¸Šã‹ã‚‰è¶³å…ƒã¾ã§ã€æ¨ªæ–¹å‘ã‚‚é‡ãªã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        // å¥³ã®å­ã®é«˜ã•ã®åŠåˆ†ã‚ˆã‚Šä¸Šï¼ˆé ­éƒ¨å´ï¼‰ã§ã‚­ãƒ£ãƒƒãƒåˆ¤å®š
        const collisionHeightThreshold = girlRect.top + girlRect.height * 0.4; // å¥³ã®å­ã®ä¸ŠåŠåˆ†ãã‚‰ã„
        
        if (grapeRect.left < girlRect.right &&
            grapeRect.right > girlRect.left &&
            grapeRect.bottom > collisionHeightThreshold && // ã¶ã©ã†ã®åº•ãŒå¥³ã®å­ã®æ¤œå‡ºç¯„å›²ã«å…¥ã£ãŸã‚‰
            grapeRect.top < girlRect.bottom) { // ã¶ã©ã†ã®ä¸Šéƒ¨ãŒå¥³ã®å­ã®è¶³å…ƒã‚ˆã‚Šä¸Šã«ã‚ã‚‹
            
            catchGrape(grape, grapeRect); // grapeRectå…¨ä½“ã‚’æ¸¡ã™ã‚ˆã†ã«å¤‰æ›´
            return true;
        }
        return false;
    }

    // catchGrapeé–¢æ•°ã«grapeRectã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’æ¸¡ã™ã‚ˆã†ã«å¤‰æ›´
    function catchGrape(grape, grapeRect) {
        grape.remove();
        gameState.grapeCount++;
        gameState.score += 10;
        
        // ã‚¹ã‚³ã‚¢ã®ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆã‚’ã¶ã©ã†ã®æ¶ˆãˆã‚‹ä½ç½®ã«è¡¨ç¤º
        // grapeRect.left + grapeRect.width / 2 ã§ã¶ã©ã†ã®ä¸­å¿ƒXåº§æ¨™ã‚’å–å¾—
        showFloatingText('+10', grapeRect.left + grapeRect.width / 2, grapeRect.top, 24);
        
        updateUI();

        // éŸ³ã‚’é³´ã‚‰ã™ãƒ­ã‚¸ãƒƒã‚¯ (Web Audio APIã‚’ä½¿ç”¨)
        const screenHeight = window.innerHeight;
        const normalizedY = grapeRect.top / screenHeight; // grapeRect.top ã‚’ä½¿ç”¨
        
        const noteIndex = Math.min(notes.length - 1, Math.max(0, Math.floor((1 - normalizedY) * notes.length))); 
        
        const noteToPlay = notes[noteIndex];
        if (frequencies[noteToPlay]) {
            playNote(frequencies[noteToPlay]);
            // éŸ³éšã®ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¹ã‚³ã‚¢ã‚ˆã‚Šå°‘ã—ä¸Šã«è¡¨ç¤º
            showFloatingText(noteToPlay.toUpperCase(), grapeRect.left + grapeRect.width / 2, grapeRect.top - 30, 18); // å°ã•ãªæ–‡å­—ã§è¡¨ç¤º
        }
        
        if (gameState.grapeCount >= 11) {
            drinkJuice();
        }
    }

    function drinkJuice() {
        gameState.health = Math.min(100, gameState.health + 30);
        gameState.grapeCount = 0;
        gameState.score += 50;
        
        // ã‚¸ãƒ¥ãƒ¼ã‚¹å®Œæˆã®ãƒ†ã‚­ã‚¹ãƒˆã‚‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½®ã§ã¯ãªãã€ä¸­å¤®ã«è¡¨ç¤º
        showFloatingText('ã‚¸ãƒ¥ãƒ¼ã‚¹å®Œæˆï¼ +50', window.innerWidth / 2, window.innerHeight / 2 - 50, 24);
        updateUI();
        updateHealth();
    }

    // showFloatingTexté–¢æ•°ã«fontSizeå¼•æ•°ã‚’è¿½åŠ 
    function showFloatingText(text, x, y, fontSize = 24) {
        const element = document.createElement('div');
        element.className = 'floating-text';
        element.textContent = text;
        // ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®æƒãˆã«ã™ã‚‹ãŸã‚ã«ã€Xåº§æ¨™ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆå¹…ã®åŠåˆ†ã‚’å¼•ã
        element.style.left = (x - (text.length * fontSize / 4)) + 'px'; // ç°¡æ˜“çš„ãªä¸­å¤®æƒãˆ
        element.style.top = y + 'px';
        element.style.fontSize = fontSize + 'px'; // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’è¨­å®š
        document.getElementById('gameContainer').appendChild(element);
        
        setTimeout(() => element.remove(), 1000);
    }

    function updateUI() {
        document.getElementById('score').textContent = gameState.score;
        document.getElementById('grapeCount').textContent = gameState.grapeCount;
        drawJuice();
    }

    function updateHealth() {
        const healthPercent = Math.max(0, gameState.health / 100 * 100);
        document.getElementById('healthFill').style.width = healthPercent + '%';
        
        if (gameState.health <= 0) {
            gameOver();
        }
    }

    function gameOver() {
        gameState.isPlaying = false;
        alert(`ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼\nã‚¹ã‚³ã‚¢: ${gameState.score}`);
        location.reload();
    }

    // ã‚¸ãƒ£ãƒ³ãƒ—æ©Ÿèƒ½
    function jump() {
        if (!gameState.isPlaying || gameState.isJumping) return;

        gameState.isJumping = true;
        girlCanvas.classList.add('jumping'); // CSSã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã¦ã‚¸ãƒ£ãƒ³ãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹

        setTimeout(() => {
            girlCanvas.classList.remove('jumping'); // CSSã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã¦å…ƒã«æˆ»ã‚‹
            gameState.isJumping = false;
        }, 400); // ã‚¸ãƒ£ãƒ³ãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ™‚é–“ï¼ˆCSSã®transitionæ™‚é–“ã¨åˆã‚ã›ã‚‹ï¼‰
    }

    // ã‚²ãƒ¼ãƒ é–‹å§‹é–¢æ•° (HTMLã®onclickå±æ€§ã‹ã‚‰å‘¼ã°ã‚Œã‚‹)
    function startGame() {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã£ãŸã¨ãã«AudioContextã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }

        if (!isGirlImageLoaded) {
            alert("ç”»åƒã®èª­ã¿è¾¼ã¿ä¸­ã§ã™ã€‚ã‚‚ã†ä¸€åº¦ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚");
            return;
        }
        document.getElementById('startScreen').style.display = 'none';
        gameState.isPlaying = true;
        drawJuice();
        gameLoop();
    }

    function gameLoop() {
        if (!gameState.isPlaying) return;
        
        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç§»å‹•ã‚’æ›´æ–°
        if (gameState.moveDirection !== 0) {
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ–°ã—ã„Xåº§æ¨™ã‚’è¨ˆç®—
            let newGirlX = gameState.girlX + gameState.moveDirection * gameState.playerSpeed;
            
            // ç”»é¢ã®ç«¯ã«è¡Œãéããªã„ã‚ˆã†ã«åˆ¶å¾¡
            const girlWidth = girlCanvas.width;
            newGirlX = Math.max(girlWidth / 2, Math.min(window.innerWidth - (girlWidth / 2), newGirlX));
            
            gameState.girlX = newGirlX;
            girlCanvas.style.left = (gameState.girlX - girlWidth / 2) + 'px';
        }

        if (Math.random() < gameState.spawnRate) {
            createGrape();
        }
        
        const grapes = document.querySelectorAll('.grape');
        grapes.forEach(grape => {
            checkCollision(grape); 
        });
        
        if (Math.random() < 0.005) { 
            gameState.health -= 1;
            updateHealth();
        }
        
        requestAnimationFrame(gameLoop);
    }

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•ï¼ˆãƒã‚¦ã‚¹/ã‚¿ãƒƒãƒï¼‰
    function handleMove(clientX) {
        if (!gameState.isPlaying) return;
        
        const girlWidth = girlCanvas.width;
        gameState.girlX = Math.max(girlWidth / 2, Math.min(window.innerWidth - (girlWidth / 2), clientX));
        girlCanvas.style.left = (gameState.girlX - girlWidth / 2) + 'px';
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.addEventListener('mousemove', (e) => handleMove(e.clientX));
    document.addEventListener('touchmove', (e) => {
        e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
        handleMove(e.touches[0].clientX);
    }, { passive: false });

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ (ã‚¸ãƒ£ãƒ³ãƒ—ã¨å·¦å³ç§»å‹•)
    document.addEventListener('keydown', (e) => {
        if (!gameState.isPlaying) return;

        if (e.code === 'Space' || e.code === 'ArrowUp') {
            e.preventDefault(); // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã©ã‚’é˜²æ­¢
            jump();
        } else if (e.code === 'ArrowLeft') {
            gameState.moveDirection = -1; // å·¦ç§»å‹•
        } else if (e.code === 'ArrowRight') {
            gameState.moveDirection = 1; // å³ç§»å‹•
        }
    });

    document.addEventListener('keyup', (e) => {
        if (!gameState.isPlaying) return;

        if (e.code === 'ArrowLeft' || e.code === 'ArrowRight') {
            // æŠ¼ã•ã‚Œã¦ã„ãŸã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸã‚‰ç§»å‹•ã‚’åœæ­¢
            // ä¸¡æ–¹ã®ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ç‰‡æ–¹ãŒé›¢ã•ã‚ŒãŸå ´åˆã‚’è€ƒæ…®
            if ((e.code === 'ArrowLeft' && gameState.moveDirection === -1) || 
                (e.code === 'ArrowRight' && gameState.moveDirection === 1)) {
                gameState.moveDirection = 0;
            }
        }
    });

    // ãƒã‚¦ã‚¹ ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯
    document.addEventListener('dblclick', (e) => {
        if (gameState.isPlaying) {
            jump();
        }
    });

    // ã‚¿ãƒƒãƒ ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—
    document.addEventListener('touchstart', (e) => {
        if (!gameState.isPlaying) return;
        
        const currentTime = new Date().getTime();
        const tapLength = currentTime - gameState.lastTapTime;
        
        if (tapLength < 300 && tapLength > 0) { // 300ms ä»¥å†…ã®2å›ç›®ã®ã‚¿ãƒƒãƒ—
            e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—å‹•ä½œï¼ˆã‚ºãƒ¼ãƒ ãªã©ï¼‰ã‚’é˜²æ­¢
            jump();
        }
        gameState.lastTapTime = currentTime;
    }, { passive: false });


    // åˆæœŸåŒ–
    updateUI();
    updateHealth();
    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ç”»åƒã®èª­ã¿è¾¼ã¿ãŒã¾ã ã§ã‚ã‚Œã°ã€girlCanvasã¯ä¸­å¤®ã«è¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€ã“ã“ã§å†è¨­å®š
    // onloadã‚¤ãƒ™ãƒ³ãƒˆã§è¨­å®šã•ã‚Œã‚‹ã®ã§ã€ä¸è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒå¿µã®ãŸã‚
    girlCanvas.style.left = (gameState.girlX - girlCanvas.width / 2) + 'px';
</script>
</body>
</html>
